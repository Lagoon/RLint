<html>
<head>
  <meta charset="UTF-8">
  <style>
    body { margin: 50px; font: 16px 'Palatino Linotype', 'Book Antiqua', Palatino, FreeSerif, serif; }
    h1 a, h2 a, h3 a, h4 a, h5 a, h6 a { font-weight:inherit; }
    p { text-align:justify; line-height:26px; color:#222; }
    p img { margin:0; }
    pre, tt, code { font: 12px Menlo, Monaco, Consolas, 'Lucida Console', monospace; }
    hr { border:solid #ddd; border-width:1px 0 0; clear:both; margin:10px 0 30px; height:0; }
    /* Tables */
    table { font-size:14px; border-collapse:collapse; text-align:left; margin-bottom:30px; }
    th { font-size:17px; font-weight:normal; border-bottom:2px solid #222; padding:10px 8px; }
    td { padding:10px 8px 0; }
    /* Blockquotes (from getskeleton.com) */
    blockquote, blockquote p { font-size:17px; line-height:24px; color:#444; font-style:italic; }
    blockquote { margin:0 0 20px; padding:0 0 0 19px; border-left:1px solid #ddd; }
    blockquote cite { display:block; font-size:12px; color:#444; }
    blockquote cite a, blockquote cite a:visited, blockquote cite a:visited { color:#444; }
    /* Links (from getskeleton.com) */
    a, a:visited { color:#333; text-decoration:underline; outline:0; }
    a:hover, a:focus { color:#000; }
    p a, p a:visited { line-height:inherit; }
    /* Lists (from getskeleton.com) */
    ul, ol { margin-bottom:20px; }
    ul { list-style:square outside; }
    ol { list-style:decimal; }
    ol, ul.square, ul.circle, ul.disc { margin-left:30px; }
    ul.square { list-style:square outside; }
    ul.circle { list-style:circle outside; }
    ul.disc { list-style:disc outside; }
    ul ul, ul ol,
    ol ol, ol ul { margin:4px 0 5px 30px; font-size:90%; }
    ul ul li, ul ol li,
    ol ol li, ol ul li { margin-bottom:6px; }
    li { line-height:24px; margin-bottom:12px; }
    ul.large li { line-height:21px; }
    li p { line-height:21px; }
  </style>
<head>
<body>
<h1>Gem Rlagoon</h1>

<p>    </p><p>Developed by Laboratório de Informática e Sistemas – Instituto Pedro Nunes</p>	<p>All Rights reserved to XLM, Serviços de Informática Lda.</p>	<p></p>

<h2>Index</h2>

<ol><li>Getting Started
<ol><li>Dependencies</li>
<li>Instalation</li>
<li>Generate Lagoon configuration file</li>
<li>How to use?</li>
</ol></li>
<li>Operations
<ol><li>Application operations
<ol><li>Show application</li>
<li>Update application</li>
</ol></li>
<li>Context operations
<ol><li>Create context</li>
<li>Show context</li>
<li>List contexts</li>
<li>Update context</li>
<li>Delete context</li>
</ol></li>
<li>Permission operations</li>
<li>Profile operations</li>
<li>User operations
<ol><li>Create user</li>
<li>Show user</li>
<li>List users</li>
<li>Update user</li>
<li>Register user</li>
<li>Deactivate user</li>
<li>Activate user</li>
<li>Reactivate user</li>
<li>Login</li>
<li>Logout</li>
</ol></li>
</ol></li>
<li>Handle exceptions
<ol><li>SanityProblem</li>
<li>ClientError</li>
<li>ServerError</li>
<li>Access Denied</li>
</ol></li>
</ol>

<h2>Getting Started</h2>

<p>Rlagoon is a library for connect your application with XLM, Informática e Serviços Lagoon® Application API.</p>

<h3>Depedencies</h3>

<ul><li>HttParty v0.7.8</li>
<li>Rails v3.0.9</li>
<li>Rspec v2.6.0</li>
<li>rubygems v &gt;= 1.3.4</li>
</ul>

<h3>Instalation</h3>

<p>gem “rlagoon” to your Gemfile and bundle install</p>

<h3>Generate Lagoon configuration file</h3>

<p></p><p>To add Rlagoon configuration file to your /config/initializers/ folder run:<br> “rails g rlagoon:config”.<br>Update config options with credentials and uri provided by XLM, Informática e Serviços.</p><p></p>

<h3>How to use?</h3>

<p>After add lagoon configuration file to /config/initializers folder you can access “load_lagoon” helper method inside your controllers.<br>You can add this before_filter to fetch always lagoon object on your ApplicationController.<br></p><p>	before_filter :current_lagoon</p>	<p>	def current_lagoon <br>		@lagoon = load_lagoon <br>	end <br></p><p></p>

<p></p><p>In case of your application has contexts you need to send it with option {:context =&gt; “name_context”} on “load_lagoon” helper.<br>Example: load_lagoon({:context =&gt; “your_context”})</p><p></p>

<p></p><p>You can use rlagoon to automatically authorize your controller actions. To use this function you can use “lagoon_authorization” helper method. This method authorize all of controller actions with “controller_name” and “action_name”. In case of user try access non-authorized action, rlagoon will raise AccessDennied exception (see “Handle exceptions” section).</p>Example: lagoon_authorization(user_id, {:context =&gt; “your_context”})<p></p>

<p></p><p>	def current_lagoon <br>		@lagoon = load_lagoon <br>		lagoon_authorization(user_id)	end <br></p><p></p>

<h2>Operations</h2>

<p>List or Rlagoon operations you can use.<br>Note: “*” means that attribute is mandatory.<br></p><p>If any problem was detected on request will be raise an Exception (see section “Handle exceptions”).</p><p></p>

<h3>Application operations</h3>

<h4>Show application “show_application()”</h4>

<p>Show your environment/application information.<br>This method output your environment/application information.<br>Output Example:<br>{:application =&gt;	{:id=&gt;5, <br>	 :application=&gt;“application_name”, <br>	 :modules=&gt;[“module_1”,“module_2”], <br>	 :activation_url=&gt;“http://environment.activation.url.com”, <br>	 :description=&gt;“Environment description”, <br>	 :name=&gt;“environment_name”}<br>}</p>

<h4>Update application “update_application(name,activation_url = nil,description = nil)”</h4>

<p>Update your environment/application information.<br>This method expects 4 attributes:<br>	</p>

<ul><li>name* (string): application name. <br></li>
<li>activation_url (string): environment activation URL. <br></li>
<li>url (string): environment url. <br></li>
<li>description (text): environment description. <br></li>
</ul>

<h3>Context operations</h3>

<h4>Create context “create_context(context_name,activation_url = nil, url = nil, description = nil, copy_context = nil)”</h4>

<p>Create new context for your application<br>This method expects 5 attributes:<br></p>

<ul><li>name_context* (string): context name. <br></li>
<li>activation_url (string): context activation URL. <br></li>
<li>url (string): context URL. <br></li>
<li>description (text): context description. <br></li>
<li>copy_context (boolean): copy profiles from default context (true) or configure profiles later on Lagoon user interface (false).</li>
</ul>

<p>This method output your new context information. <br>Output Example:<br>{:context =&gt;	<br>	{:id=&gt;470, <br>	 :name=&gt;“context_name”, <br>	 :profiles=&gt;<br>		{“profile_1”=&gt;{:id=&gt;959, :description=&gt;“Profile Description”}, <br>		 “profile_2”=&gt;{:id=&gt;960, :description=&gt;“Profile 2 Description”}<br>		}, <br>	 :activation_url=&gt;“http://context.activation.url/activations”, <br>	 :description=&gt;“Context Description”, <br>	 :url=&gt;“http://context.url.com”<br>	}<br>}<br></p>

<h4>Show context “show_context(context_name)”</h4>

<p>Show context information. <br>This method expects 1 attribute: <br></p>

<ul><li>name_context* (string): context name. <br></li>
</ul>

<p>This method output context information. <br>Output Example: <br>{:context =&gt; <br>	{:id=&gt;470, <br>	 :name=&gt;“context_name”, <br>	 :profiles=&gt; <br>		{“profile_1”=&gt;{:id=&gt;959, :description=&gt;“Profile Description”}, <br>		 “profile_2”=&gt;{:id=&gt;960, :description=&gt;“Profile 2 Description”} <br>		}, <br>	 :activation_url=&gt;“http://context.activation.url/activations”, <br>	 :description=&gt;“Context Description”, <br>	 :url=&gt;“http://context.url.com”<br>	}<br>}<br></p>

<h4>List contexts “contexts()”</h4>

<p>List all environment contexts. <br>This method output all environment contexts information. <br>Output Example: <br>{:contexts =&gt; <br>	{“id_context_1”=&gt; <br>		{:id=&gt;13, <br>		 :name=&gt;“default”, <br>		 :profiles=&gt; <br>			{“profile_1”=&gt; {:id=&gt;64, :description=&gt;“Profile 1 description”}, <br>		 	 “profile_2”=&gt; {:id=&gt;63, :description=&gt;“Partner Teste”}}, <br>		 :activation_url=&gt;"", <br>		 :description=&gt;“Context 1 description”, <br>		 :url=&gt;""}<br>	“id_context_2” =&gt;<br>		{:id=&gt;13, <br>	 	 :name=&gt;“default”, <br>	 	 :profiles=&gt;<br>			{“profile_1”=&gt; {:id=&gt;64, :description=&gt;“Profile 1 description”}, <br>	 	 	 “profile_2”=&gt; {:id=&gt;63, :description=&gt;“Partner Teste”}}, <br>	 	 :activation_url=&gt;"", <br>	 	 :description=&gt;“Context 2 description”, <br>	 	 :url=&gt;""}<br>	}}</p>

<h4>Update context “update_context(context_name,new_name,activation_url = nil, url = nil, description = nil)”</h4>

<p>Update context of your application<br>This method expects 5 attributes:<br></p>

<ul><li>context_name* (string): actual context name. <br></li>
<li>name_context* (string): new context name. <br></li>
<li>activation_url (string): context activation URL. <br></li>
<li>url (string): context URL. <br></li>
<li>description (text): context description. <br></li>
</ul>

<p>This method output context information updated. <br>Output Example:<br>{:context =&gt;	<br>	{:id=&gt;470, <br>	 :name=&gt;“name_updated”, <br>	 :profiles=&gt;<br>		{“profile_1”=&gt;{:id=&gt;959, :description=&gt;“Profile Description”}, <br>		 “profile_2”=&gt;{:id=&gt;960, :description=&gt;“Profile 2 Description”}<br>		}, <br>	 :activation_url=&gt;“http://context.activation.url/activations”, <br>	 :description=&gt;“Context Description”, <br>	 :url=&gt;“http://context.url.com”<br>	}<br>}<br></p>

<h4>Delete context “delete_context(context_name)”</h4>

<p>Delete context of your application<br>This method expects 1 attribute:<br></p>

<ul><li>name_context* (string): context name. <br></li>
</ul>

<p>This method output operation success. <br>Output example:<br>{:success =&gt; true}</p>

<h3>Permission operations “permissions(id_u)”</h3>

<p>Get user actual permissions from Lagoon®. <br>This method expects 1 attribute: <br></p>

<ul><li>id_u* (integer): user id.</li>
</ul>

<p>This method output current user permissions. <br>Output example: <br></p>

<h3>Profile operations “profiles()”</h3>

<p>Get environment/application profiles. <br>This method output all environment/application profiles. <br>Output example: <br>{:profiles =&gt;{<br>		“profile_1”=&gt;{:id=&gt;64, :description=&gt;“Profile 1 description”}, <br>		“profile_2”=&gt;{:id=&gt;63, :description=&gt;“Profile 2 description”}<br>		}<br>}<br></p>

<h3>User operations</h3>

<h4>Create user “create_user(login, email, name, ghost = false, profiles = nil)”</h4>

<p>Create new user. <br>This method expects 5 attributes:<br></p>

<ul><li>login* (string): user login. <br></li>
<li>email* (string): user email. <br></li>
<li>name* (string): user name. <br></li>
<li>ghost* (boolean): if your want create a user without send activation notification (true). <br></li>
<li>profiles (text): context description. <br></li>
</ul>

<p>This method output your new user information. <br>Output Example:<br>{:user =&gt;	<br>	{:id=&gt;160, <br>	 :active=&gt;false, <br>	 :ghost=&gt;false, <br>	 :login=&gt;“login”, <br>	 :name=&gt;“user name”, <br>	 :email=&gt;“user@email.com”, <br>	 :profiles=&gt;{<br>			“profile_1”=&gt;{:id=&gt;1097, :description=&gt;“Profile description”}<br>				}, <br>	 :token=&gt;“tokenassdasdwq2213123sadsx”<br>	} <br>}<br></p>

<h4>Show user “show_user(id_u)”</h4>

<p>Show user information. <br>This method expects 1 attribute: <br></p>

<ul><li>u_id* (string): user id. <br></li>
</ul>

<p>This method output your user (u_id) information. <br>Output Example:<br>{:user =&gt;	<br>	{:id=&gt;160, <br>	 :active=&gt;false, <br>	 :ghost=&gt;false, <br>	 :login=&gt;“login”, <br>	 :name=&gt;“user name”, <br>	 :email=&gt;“user@email.com”, <br>	 :profiles=&gt;{<br>			“profile_1”=&gt;{:id=&gt;1097, :description=&gt;“Profile description”}<br>				}, <br>	 :token=&gt;nil<br>	} <br>}<br></p>

<h4>List users “users()”</h4>

<p>List all users. <br>This method output all users information. <br>Output Example: <br>{:users =&gt; <br>	{“user_1_login”=&gt;		{:id=&gt;164, 		 :active=&gt;false, 		 :ghost=&gt;false, 		 :login=&gt;“user_1_login”, 		 :name=&gt;“User 1”, 		 :email=&gt;“user_1@email.com”, 		 :profiles=&gt;{				“profile_1”=&gt;{:id=&gt;1113, :description=&gt;“Profile 1 description”}				}, 		 :token=&gt;nil		}	 “user_2_login”=&gt;		{:id=&gt;164, 		 :active=&gt;false, 		 :ghost=&gt;false, 		 :login=&gt;“user_2_login”, 		 :name=&gt;“User 2”, 		 :email=&gt;“user_2@email.com”, 		 :profiles=&gt;{				“profile_2”=&gt;{:id=&gt;1113, :description=&gt;“Profile 2 description”}				}, 		 :token=&gt;nil}	}}</p>

<h4>Update user “update_user(id_u, login, email, name, ghost = nil, profiles = nil)”</h4>

<p>Update user information.<br>This method expects 5 attributes:<br></p>

<ul><li>id_u* (integer): user id. <br></li>
<li>login* (string): user login. <br></li>
<li>email* (string): user email. <br></li>
<li>name* (string): user name. <br></li>
<li>ghost* (boolean): if your want create a user without send activation notification (true). <br></li>
<li>profiles (text): context description. <br></li>
</ul>

<p>This method output user information updated. <br>Output Example:<br>{:user =&gt;	<br>	{:id=&gt;160, <br>	 :active=&gt;false, <br>	 :ghost=&gt;false, <br>	 :login=&gt;“login”, <br>	 :name=&gt;“user name updated”, <br>	 :email=&gt;“user@email.com”, <br>	 :profiles=&gt;{<br>			“profile_1”=&gt;{:id=&gt;1097, :description=&gt;“Profile description”}<br>				}, <br>	 :token=&gt;nil<br>	} <br>}<br></p>

<h4>Register user “register(password,token)”</h4>

<p>Register user via activation_url. <br>This method expects 2 attributes: <br></p>

<ul><li>password* (string): user password. <br></li>
<li>token* (string): token sent to user via activation email. <br></li>
</ul>

<p>This method output user information. <br>Output Example:<br>{:user =&gt;	<br>	{:id=&gt;160, <br>	 :active=&gt;true, <br>	 :ghost=&gt;false, <br>	 :login=&gt;“login”, <br>	 :name=&gt;“user name updated”, <br>	 :email=&gt;“user@email.com”, <br>	 :profiles=&gt;{<br>			“profile_1”=&gt;{:id=&gt;1097, :description=&gt;“Profile description”}<br>				}, <br>	 :token=&gt;nil<br>	} <br>}<br></p>

<h4>Deactivate user “deactivation(id_u)”</h4>

<p>Deactivate user account. <br>This method expects 1 attribute: <br></p>

<ul><li>id_u* (integer): user password. <br></li>
</ul>

<p>This method output user information. <br>Output Example:<br>{:user =&gt;	<br>	{:id=&gt;160, <br>	 :active=&gt;false, <br>	 :ghost=&gt;false, <br>	 :login=&gt;“login”, <br>	 :name=&gt;“user name updated”, <br>	 :email=&gt;“user@email.com”, <br>	 :profiles=&gt;{<br>			“profile_1”=&gt;{:id=&gt;1097, :description=&gt;“Profile description”}<br>				}, <br>	 :token=&gt;nil<br>	} <br>}<br></p>

<h4>Activate user “activation(id_u)”</h4>

<p>Activate user account. <br>This method expects 1 attribute: <br></p>

<ul><li>id_u* (integer): user password. <br></li>
</ul>

<p>This method output user information. <br>Output Example:<br>{:user =&gt;	<br>	{:id=&gt;160, <br>	 :active=&gt;true, <br>	 :ghost=&gt;false, <br>	 :login=&gt;“login”, <br>	 :name=&gt;“user name updated”, <br>	 :email=&gt;“user@email.com”, <br>	 :profiles=&gt;{<br>			“profile_1”=&gt;{:id=&gt;1097, :description=&gt;“Profile description”}<br>				}, <br>	 :token=&gt;nil<br>	} <br>}<br></p>

<h4>Reactivate user “reactivation(id_u)”</h4>

<p>Reactivate user account and send activation email. <br>This method expects 1 attribute: <br></p>

<ul><li>id_u* (integer): user password. <br></li>
</ul>

<p>This method output user information. <br>Output Example:<br>{:user =&gt;	<br>	{:id=&gt;160, <br>	 :active=&gt;false, <br>	 :ghost=&gt;false, <br>	 :login=&gt;“login”, <br>	 :name=&gt;“user name updated”, <br>	 :email=&gt;“user@email.com”, <br>	 :profiles=&gt;{<br>			“profile_1”=&gt;{:id=&gt;1097, :description=&gt;“Profile description”}<br>				}, <br>	 :token=&gt;nil<br>	} <br>}<br></p>

<h4>Login “login(login,password)”</h4>

<p>User login. <br>This method expects 2 attributes: <br></p>

<ul><li>login* (string): user login. <br></li>
<li>password* (string): user password. <br></li>
</ul>

<p>This method output user information and permissions. <br>{:user=&gt;{ <br>		:id=&gt;10, <br>		:active=&gt;true, <br>		:ghost=&gt;false, <br>		:login=&gt;“user@mail.com”, <br>		:name=&gt;“name_user”, <br>		:email=&gt;“user@mail.com”,<br>		:profiles=&gt;{“name_profile”=&gt; <br>						{:actions=&gt;{<br>							“action_1”=&gt;{:action_points=&gt;[“ap_1”,“ap2”]},<br>							“action_2”=&gt;{:action_points=&gt;[“ap_1”,“ap2”]}, <br>							}<br>					“name_profile_2”=&gt;<br>						{:actions=&gt;{<br>							“action_3”=&gt;{:action_points=&gt;[“ap_1”,“ap2”]},<br>							“action_4”=&gt;{:action_points=&gt;[“ap_1”,“ap2”]},<br>							}<br>						}<br>					}, <br>		:last_login=&gt;1326815905000<br>		}<br>}<br></p>

<h4>Logout “logout(id_u)”</h4>

<p>User logout. <br>This method expects 1 attribute: <br></p>

<ul><li>id_u* (integer): user id. <br></li>
</ul>

<p>This method output operation success. <br>{:success=&gt; true}</p>

<h2>Handle exceptions</h2>

<p>	</p>

<h3>SanityProblem</h3>

<p>If credentials present on config file, or first connection to Lagoon® fails, a Rlagoon::SanityProblem exception will be raised on application start.</p>

<h3>ClientError</h3>

<p></p><p>If any problem was detected on client request (ex: wrong attributes sent) Lagoon® will sent a client error on http status code. Rlagoon will raise a Rlagoon::ClientError exception. You can catch this and modify it behavior in ApplicationController.</p><p></p>

<p></p><p>class ApplicationController &lt; ActionController::Base <br>	rescue from Rlagoon::ClientError do |exception|<br>		redirect_to root_url, :alert =&gt; “some alert”<br>	end<br>end<br></p><p></p>

<h3>ServerError</h3>

<p></p><p>If any problem occur on server (ex: internal server error) Rlagoon will raise a Rlagoon::ServerError exception. You can catch this and modify it behavior in ApplicationController</p><p></p>

<p></p><p>class ApplicationController &lt; ActionController::Base <br>	rescue from Rlagoon::ServerError do |exception|<br>		redirect_to root_url, :alert =&gt; “some alert”<br>	end<br>end<br></p><p></p>

<h3>AccessDenied</h3>

<p></p><p>If you user “load_authorization” helper method and current user cannot access some action, a Rlagoon::AccessDenied exception will be raised. You can catch this and modify it behavior in ApplicationController</p><p></p>

<p></p><p>class ApplicationController &lt; ActionController::Base<br>	rescue from Rlagoon::AccessDenied do |exception|<br>		redirect_to root_url, :alert =&gt; “some alert”<br>	end<br>end<br></p><p></p>


</body>
</html>
